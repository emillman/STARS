#!/bin/bash
#
# Deploys stars. Any arguments given will be passed to the package script.

# Quit if any command fails or if any variable is unbound
set -o errexit -o nounset

# If launched through a symlink, check for an env.sh file in that directory.
# If that does not exist, use the one in the script's actual location.
SCRIPT_DIR="$( dirname "${BASH_SOURCE[0]}" )"
[ -r "${SCRIPT_DIR}/env.sh" ] || SCRIPT_DIR="$( dirname "$(readlink -e "${BASH_SOURCE[0]}")" )"
source "${SCRIPT_DIR}/env.sh"

if [ $RHOST ]; then
	ssh "$RHOST" "cd '$SPATH' && git pull && git up && ./package $@ && ./deploy '$DPATH'"
else
	cd "$SPATH" && git pull && git up && ./package "$@" && ./deploy "$DPATH"
fi
